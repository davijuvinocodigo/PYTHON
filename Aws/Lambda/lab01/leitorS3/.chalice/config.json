{
  "version": "2.0",
  "app_name": "s3-csv-to-rds",
  "stages": {
    "dev": {
      "api_gateway_stage": "api",
      "environment_variables": {
        "RDS_HOST": "database-1.cc1uw02m0ewj.us-east-1.rds.amazonaws.com",
        "RDS_USER": "admin",
        "RDS_PASSWORD": "12345678"
      },
      "lambda_functions": {
        "handle_csv_upload": {
          "lambda_timeout": 120,
          "lambda_memory_size": 512,
          "vpc_config": {
            "SubnetIds": ["subnet-09c980dae7b15421a", "subnet-06f3894253ae78bb8", "subnet-0274913f946b05730", "subnet-0f4ff337fa0d263ac", "subnet-053be86fac580816b", "subnet-07f09c7ae2cda2165"],
            "SecurityGroupIds": ["sg-0d172208a73c8f6fa"]
          }
        }
      },
      "iam_policy": {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "ec2:CreateSecurityGroup",
              "ec2:DescribeSecurityGroups",
              "ec2:DescribeSubnets",
              "ec2:DescribeVpcs",
              "ec2:AuthorizeSecurityGroupIngress",
              "ec2:AuthorizeSecurityGroupEgress",
              "ec2:RevokeSecurityGroupEgress",
              "ec2:CreateNetworkInterface",
              "ec2:DeleteNetworkInterface",
              "ec2:DescribeNetworkInterfaces",
              "s3:ListBucket",
              "s3:GetBucketLocation",
              "s3:PutObject",
              "s3:PostObject",
              "s3:GetObject",
              "s3:DeleteObject"
            ],
            "Resource": [
                      "arn:aws:s3:::dev-bucket-lab01/entrada/*",
                      "arn:aws:s3:::dev-bucket-lab01/entrada/dados.csv"
                  ]
          },
          {
            "Effect": "Allow",
            "Action": [
              "rds-db:connect",
              "rds:CreateDBProxy",
              "rds:CreateDBInstance",
              "rds:CreateDBSubnetGroup",
              "rds:DescribeDBClusters",
              "rds:DescribeDBInstances",
              "rds:DescribeDBSubnetGroups",
              "rds:DescribeDBProxies",
              "rds:DescribeDBProxyTargets",
              "rds:DescribeDBProxyTargetGroups",
              "rds:RegisterDBProxyTargets",
              "rds:ModifyDBInstance",
              "rds:ModifyDBProxy"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "lambda:CreateFunction",
              "lambda:ListFunctions",
              "lambda:UpdateFunctionConfiguration"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "iam:AttachRolePolicy",
              "iam:AttachPolicy",
              "iam:CreateRole",
              "iam:CreatePolicy"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "secretsmanager:GetResourcePolicy",
              "secretsmanager:GetSecretValue",
              "secretsmanager:DescribeSecret",
              "secretsmanager:ListSecretVersionIds",
              "secretsmanager:CreateSecret"
            ],
            "Resource": "*"
          }
        ]
      }
    }
  }
}

